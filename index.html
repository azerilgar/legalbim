<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

    <meta name="cesium-sandcastle-labels" content="Showcases, DataSources">
	
  <title>3D Valuation Information</title>



<!--  <base href="localhost:8080/Apps/">   -->



  <script type="text/javascript" src="Sandcastle-header.js"></script> 
 <!--     <script type="text/javascript" src="../ThirdParty/requirejs-2.1.20/require.js"></script>  -->
	
	<script src="Cesium.js"></script>
	
<!--     <script type="text/javascript">
    require.config({
        baseUrl : '../Source',
        waitSeconds : 60
    });
    </script> -->
	
</head>

<!-- <body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
 -->
  <style>
     @import url(bucket.css);
	  
	    #toolbar {
        background: rgba(42, 42, 42, 0.8);
        padding: 4px;
        border-radius: 4px;
    }
    #toolbar input {
        vertical-align: middle;
        padding-top: 2px;
        padding-bottom: 2px;
    }

    
	 .cesium-viewer-dbSearchContainer .cesium-dbSearch-input {
    border: solid 1px #444;
    background-color: rgba(40, 40, 40, 0.7);
    color: white;
    display: inline-block;
    vertical-align: middle;
    width: 0;
    height: 32px;
    margin: 0;
    padding: 0 32px 0 0;
    border-radius: 0;
    box-sizing: border-box;
    transition: width ease-in-out 0.25s, background-color 0.2s ease-in-out;
    -webkit-appearance: none;
}

.cesium-viewer-dbSearchContainer:hover .cesium-dbSearch-input {
    border-color: #aef;
    box-shadow: 0 0 8px #fff;
}

.cesium-viewer-dbSearchContainer .cesium-dbSearch-input:focus {
    border-color: #ea4;
    background-color: rgba(15, 15, 15, 0.9);
    box-shadow: none;
    outline: none;
}

.cesium-viewer-dbSearchContainer:hover .cesium-dbSearch-input,
.cesium-viewer-dbSearchContainer .cesium-dbSearch-input:focus,
.cesium-viewer-dbSearchContainer .cesium-dbSearch-input-wide {
    padding-left: 4px;
    width: 250px;
}



.cesium-dbSearch-searchButton {
    background-color: #303336;
    display: inline-block;
    position: absolute;
    cursor: pointer;
    width: 32px;
    top: 1px;
    right: 1px;
    height: 30px;
    vertical-align: middle;
    fill: #edffff;
}

.cesium-dbSearch-searchButton:hover {
    background-color: #48b;
}


#toolbarCadastre {
    margin: 5px;
    padding: 2px 5px;
    position: absolute;
}

    table {
        border-collapse: collapse;
    }

    table, td, th {
        border: 1px solid black;
    }

    .popup {
            display:none;
             position:absolute; 
             //min-width:450px; 
             //min-height:200px;
             padding:5px; 
             border:1px solid black;
             //background-color:#bbbbbb; font-size:13px;
		 background-color:#ffffff;
		 color:black;
		 font-size:13px;
    }	
	
	  
	  
  </style>
  
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar"></div>
<div id="toolbarCadastre"></div>
<div id="onclickInfo" class="popup"></div>
  
<div class="toolbar-left">
	 <button class="cesium-button" type="checkbox" id="showCheckbox1" >
	 <label>
		<input type="checkbox" id="showCheckbox"  />
		Show Building
		</label>
	 </div>

<script id="cesium_sandcastle_script">

Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NjMyNTQ1YS1hNjE3LTQ2ZjItOGU2My1lMDM0Y2JkNWMwYzQiLCJpZCI6ODA1MSwiaWF0IjoxNjAxMzQwNjc1fQ.75qy84lpW7uQ-IIIPRYFRk__hoXxqQ2hsq5MB3Bn-80';
var viewer = new Cesium.Viewer('cesiumContainer');
var scene = viewer.scene;


 <!-- var building = new Cesium.Cesium3DTileset({ -->
 <!-- url: 'localhost:8080/Apps/building/tileset.json'  -->
<!-- }); -->
 
<!-- var addbuilding= scene.primitives.add(building,1); -->
   <!-- <!-- scene.primitives(1).show= false; --> -->
   <!-- addbuilding.style = new Cesium.Cesium3DTileStyle({ -->
    <!-- color : 'rgba(0, 102, 204, 0.5)' -->
<!-- }); -->
   <!-- addbuilding.show = false; -->
 
var building = viewer.scene.primitives.add(
  new Cesium.Cesium3DTileset({
    url: Cesium.IonResource.fromAssetId(160342),
  })
);
building.show = false;
var style1 = new Cesium.Cesium3DTileStyle({ 
color : 'rgba(0, 102, 204, 0.9)'
});
 building.style = style1;  

 
 
  <!-- var buildingin = new Cesium.Cesium3DTileset({ -->
 <!-- url: 'localhost:8080/Apps/buildingin/tileset.json'  -->
<!-- }); -->
 
<!-- var addbuildingin= scene.primitives.add(buildingin,2); -->
   <!-- <!-- scene.primitives(1).show= false; --> -->
   <!-- addbuildingin.style = new Cesium.Cesium3DTileStyle({ -->
    <!-- color : 'rgba(0, 102, 204, 0.9)' -->
<!-- }); -->
   <!-- addbuildingin.show = false; -->
   
   var addbuildingin = viewer.scene.primitives.add(
  new Cesium.Cesium3DTileset({
    url: Cesium.IonResource.fromAssetId(160345),
  })
);
var style = new Cesium.Cesium3DTileStyle({ 
color : 'rgba(0, 102, 204, 0.9)'
});
 addbuildingin.style = style;  
 addbuildingin.show = false;  
   
   
   
 <!-- var tilesetOTHER=scene.primitives.add ( -->
	<!-- new Cesium.Cesium3DTileset({ -->
	<!-- url: 'localhost:8080/Apps/OTHER/tileset.json' -->
	<!-- }) -->
	<!-- ); -->
 
 var tilesetOTHER = viewer.scene.primitives.add(
  new Cesium.Cesium3DTileset({
    url: Cesium.IonResource.fromAssetId(160346),
  })
);

<!-- var tileset=scene.primitives.add ( -->
	<!-- new Cesium.Cesium3DTileset({ -->
	<!-- url: 'localhost:8080/Apps/FAT/tileset.json' -->
	<!-- }) -->
	<!-- ); -->

var tileset = viewer.scene.primitives.add(
  new Cesium.Cesium3DTileset({
    url: Cesium.IonResource.fromAssetId(160357),
  })
);

var checkbox = document.getElementById('showCheckbox');
checkbox.addEventListener('change', function() {
    // Checkbox state changed.
    if (checkbox.checked) {
        // Show if not shown.
        if (!viewer.dataSources.contains(building)) {
            building.show = true;
			addbuildingin.show = true;
		   }
    } else {
        // Hide if currently shown.
      		if (building.show = true) {
		       building.show = false;
			   addbuildingin.show = false;
        }
    }
}, false);

tileset.readyPromise.then(function(tileset) {
    viewer.zoomTo(tileset, new Cesium.HeadingPitchRange(1.5, -0.4, tileset.boundingSphere.radius * 3.0));

    // Override the default home button = reset to location of tileset instead of to world globe
    viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function (e) {
	e.cancel = true;
	viewer.zoomTo(tileset, new Cesium.HeadingPitchRange(1.5, -0.4, tileset.boundingSphere.radius * 3.0));
    });
}).otherwise(function(error) {
    console.log(error);
});


var handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);
handler.setInputAction(function(movement) {
    <!-- if (!picking) { -->
        <!-- return; -->
    <!-- } -->

    var feature = scene.pick(movement.endPosition);

    <!-- unselectFeature(selectedFeature); -->

 //   if (feature instanceof Cesium.Cesium3DTileFeature) {
   //     selectFeature(feature);
    // }
}, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
// In this tileset every feature has an "element" property which is a global ID.
// This property is used to associate features across different tiles and LODs.
// Workaround until 3D Tiles has the concept of global batch ids: https://github.com/AnalyticalGraphicsInc/3d-tiles/issues/265
var elementMap = {}; // Build a map of elements to features.


function unloadFeature(feature) {
    unselectFeature(feature);
    var element = getElement(feature);
    var features = elementMap[element];
    var index = features.indexOf(feature);
    if (index > -1) {
        features.splice(index, 1);
    }
}

function loadFeature(feature) {
    var element = getElement(feature);
    var features = elementMap[element];
    if (!Cesium.defined(features)) {
        features = [];
        elementMap[element] = features;
    }
    features.push(feature);

    if (hiddenElements.indexOf(element) > -1) {
        feature.show = false;
    }
}

function processContentFeatures(content, callback) {
    var featuresLength = content.featuresLength;
    for (var i = 0; i < featuresLength; ++i) {
        var feature = content.getFeature(i);
        callback(feature);
    }
}

function processTileFeatures(tile, callback) {
    var content = tile.content;
    var innerContents = content.innerContents;
    if (Cesium.defined(innerContents)) {
        var length = innerContents.length;
        for (var i = 0; i < length; ++i) {
            processContentFeatures(innerContents[i], callback);
        }
    } else {
        processContentFeatures(content, callback);
    }
}

tileset.tileLoad.addEventListener(function(tile) {
    processTileFeatures(tile, loadFeature);
});

tileset.tileUnload.addEventListener(function(tile) {
    processTileFeatures(tile, unloadFeature);
});

// HTML overlay for showing feature name on mouseover
var nameOverlay = document.createElement('div');
viewer.container.appendChild(nameOverlay);
nameOverlay.className = 'backdrop';
nameOverlay.style.display = 'none';
nameOverlay.style.position = 'absolute';
nameOverlay.style.bottom = '0';
nameOverlay.style.left = '0';
nameOverlay.style['pointer-events'] = 'none';
nameOverlay.style.padding = '50x';
nameOverlay.style.backgroundColor = 'black';


var selected = {
    feature: undefined,
    originalColor: new Cesium.Color()
};

var selectedEntity = new Cesium.Entity();

var clickHandler = viewer.screenSpaceEventHandler.getInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);

var highlighted = {
    feature : undefined,
    originalColor : new Cesium.Color()
};

viewer.screenSpaceEventHandler.setInputAction(function onMouseMove(movement) {
    // If a feature was previously highlighted, undo the highlight
    if (Cesium.defined(highlighted.feature)) {
        highlighted.feature.color = highlighted.originalColor;
        highlighted.feature = undefined;
    }
    // Pick a new feature
    var pickedFeature = viewer.scene.pick(movement.endPosition);
    if (!Cesium.defined(pickedFeature)) {
        nameOverlay.style.display = 'none';
        return;
    }
    // A feature was picked, so show it's overlay content
    nameOverlay.style.display = 'block';
    nameOverlay.style.bottom = viewer.canvas.clientHeight - movement.endPosition.y + 'px';
    nameOverlay.style.left = movement.endPosition.x + 'px';
    var name = pickedFeature.getProperty('condoid');
    if (!Cesium.defined(name)) {
        name = pickedFeature.getProperty('condoid');
    }
    nameOverlay.textContent = name;
    // Highlight the feature if it's not already selected.
    if (pickedFeature !== selected.feature) {
        highlighted.feature = pickedFeature;
        Cesium.Color.clone(pickedFeature.color, highlighted.originalColor);
        pickedFeature.color = Cesium.Color.TURQUOISE;
    }
    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

    // Color a feature on selection and show metadata in the InfoBox.
    viewer.screenSpaceEventHandler.setInputAction(function onLeftClick(movement) {
        // If a feature was previously selected, undo the highlight
        if (Cesium.defined(selected.feature)) {
            selected.feature.color = selected.originalColor;
            selected.feature = undefined;
        }
        // Pick a new feature
        var pickedFeature = viewer.scene.pick(movement.position);
        if (!Cesium.defined(pickedFeature)) {
            clickHandler(movement);
            return;
        }
        // Select the feature if it's not already selected
        if (selected.feature === pickedFeature) {
            return;
        }
        selected.feature = pickedFeature;
        // Save the selected feature's original color
        if (pickedFeature === highlighted.feature) {
            Cesium.Color.clone(highlighted.originalColor, selected.originalColor);
            highlighted.feature = undefined;
        } else {
            Cesium.Color.clone(pickedFeature.color, selected.originalColor);
        }
        // Highlight newly selected feature
        pickedFeature.color = Cesium.Color.YELLOW;
        // Set feature infobox description
		
		
		if (pickedFeature.getProperty('valueType')=="Tax value")		{
		 var featureName = "Condominium Information";
        selectedEntity.name = featureName;
        selectedEntity.description = 'Loading <div class="cesium-infoBox-loading"></div>';
        viewer.selectedEntity = selectedEntity;
        selectedEntity.description = '<table class="cesium-infoBox-defaultTable"><tbody>' +
                                     '<tr><th>Condominium unit id</th><td>' + pickedFeature.getProperty('condoid') + '</td></tr>' +
                                     '<tr><th>Value type</th><td>' + pickedFeature.getProperty('valueType') + '</td></tr>' +
									 '<tr><th>Assessed value (TL)</th><td>' + pickedFeature.getProperty('assessedValue') + '</td></tr>' +
									 '<tr><th>Value of accessory part (TL)</th><td>' + pickedFeature.getProperty('valueOfAccessoryPart') + '</td></tr>' +
									 '<tr><th>Total condominium unit value (TL)</th><td>' + pickedFeature.getProperty('valueOfAccessoryPart') + '</td></tr>' +
                                     '<tr><th>Condominium use</th><td>' + pickedFeature.getProperty('condominiumUseType') + '</td></tr>' +
                                     '<tr><th>Condominium area (&#13217;)</th><td>' + pickedFeature.getProperty('condominiumAreaSize') + '</td></tr>' +
									 '<tr><th>Condominium area type</th><td>' + pickedFeature.getProperty('condominiumAreaType') + '</td></tr>' +
                                     '<tr><th>Share in common places</th><td>' + pickedFeature.getProperty('shareInJointFacilities') + '</td></tr>' +
									 '<tr><th>Area of accessory part (&#13217;)</th><td>' + pickedFeature.getProperty('areaOfAccessoryPart') + '</td></tr>' +
                                     '<tr><th>Accessory part</th><td>' + pickedFeature.getProperty('accessoryPartType') + '</td></tr>' +
									 '<tr><th>Revaluation rate</th><td>' + pickedFeature.getProperty('revaluationRate') + '</td></tr>' +
									 '<tr><th>Date of revaluation</th><td>' + pickedFeature.getProperty('dateOfRevaluation') + '</td></tr>' +
									 '<tr><th>Condominium main part volume (&#13221;)</th><td>' + pickedFeature.getProperty('volumeOfCondominium') + '</td></tr>' +
									 '<tr><th>Appeal status </th><td>' + pickedFeature.getProperty('appealStatus') + '</td></tr>' +
                                     '</tbody></table>';
									 }
		else if (pickedFeature.getProperty('parcelUseType')=="Urban land")		{				 
		var featureName1 = "Parcel Information";
        selectedEntity.name = featureName1;
        selectedEntity.description = 'Loading <div class="cesium-infoBox-loading"></div>';
        viewer.selectedEntity = selectedEntity;
        selectedEntity.description = '<table class="cesium-infoBox-defaultTable"><tbody>' +
                                     '<tr><th>Parcel ID</th><td>' + pickedFeature.getProperty('ParcelID') + '</td></tr>' +
                                     '<tr><th>Parcel number</th><td>' + pickedFeature.getProperty('parcelNumber') + '</td></tr>' +
									 '<tr><th>Parcel unit value (TL/&#13217;)</th><td>' + pickedFeature.getProperty('streetBasedUnitValue') + '</td></tr>' +
                                     '<tr><th>Date of parcel unit value</th><td>' + pickedFeature.getProperty('dateOfStreetBasedValue') + '</td></tr>' +
                                     '<tr><th>Parcel area (&#13217);</th><td>' + pickedFeature.getProperty('parcelArea') + '</td></tr>' +
                                     '<tr><th>Parcel use</th><td>' + pickedFeature.getProperty('parcelUseType') + '</td></tr>' +
                                     
                                     '</tbody></table>';							 
									 }
									 
		else  	{				 
		var featureName2 = "Building Information";
        selectedEntity.name = featureName2;
        selectedEntity.description = 'Loading <div class="cesium-infoBox-loading"></div>';
        viewer.selectedEntity = selectedEntity;
        selectedEntity.description = '<table class="cesium-infoBox-defaultTable"><tbody>' +
                                     '<tr><th>Building ID</th><td>' + pickedFeature.getProperty('buildingID') + '</td></tr>' +
                                     '<tr><th>Building quality</th><td>' + pickedFeature.getProperty('buildingQualityType') + '</td></tr>' +
									 '<tr><th>Building age</th><td>' + pickedFeature.getProperty('buildingAge') + '</td></tr>' +
									 '<tr><th>Legal status</th><td>' + pickedFeature.getProperty('legalStatusType') + '</td></tr>' +
                                     '<tr><th>Building construction type</th><td>' + pickedFeature.getProperty('buildingConstructionType') + '</td></tr>' +
									 '<tr><th>Total gross area (&#13217;)</th><td>' + pickedFeature.getProperty('totalGrossAreaOfBuilding') + '</td></tr>' +
                                     '<tr><th>Unit cost price (TL/&#13217;)</th><td>' + pickedFeature.getProperty('costPricePerSqM') + '</td></tr>' +
                                     '<tr><th>Date of unit cost price</th><td>' + pickedFeature.getProperty('dateOfCostPrice') + '</td></tr>' +
                                     
                                     '</tbody></table>';							 
									 }
						
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

	</script>
	</body>
</html>
